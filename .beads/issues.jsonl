{"id":"mcp_agent_mail-01h","title":"Implement am doctor diagnostic command","description":"Add 'am doctor' CLI command to diagnose and repair common failure modes: stale locks, orphaned records, FTS sync, archive-DB consistency. Includes backup before any destructive operations.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T19:49:53.466699-05:00","created_by":"jemanuel","updated_at":"2026-01-06T19:50:53.547583-05:00","closed_at":"2026-01-06T19:50:53.547583-05:00","close_reason":"Already implemented - discovered during exploration"}
{"id":"mcp_agent_mail-0uh","title":"Replace sorted()[:n] with heapq.nlargest() for top-N selection","description":"# Replace sorted()[:n] with heapq.nlargest() (preserve stability)\n\n## Problem\n`sorted(items, key=...)[:n]` is O(m log m). For small n it can be O(m log n).\n\n## Critical constraint\n**Output order must remain identical**, including stable ordering of ties. `sorted()` is stable; `heapq.nlargest()` is not guaranteed stable by default.\n\n## Safe approach\n- Only use heapq when `n \u003c\u003c len(items)`.\n- Preserve stability by including an index tiebreaker in the key:\n  - Build `indexed = list(enumerate(items))`\n  - Use key `(score, -index)` for descending score + stable order\n  - Extract items in returned order\n- If preserving stability is messy or risks behavior change, keep `sorted()`.\n\n## Acceptance criteria\n- Results exactly match current output for all tie scenarios.\n- Covered by unit tests that include equal-score cases.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:09:24.746029498-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.231576323-05:00","closed_at":"2026-01-12T01:48:46.231576323-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-16q","title":"Integration Tests: Archive Save/Restore","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.486081-05:00","updated_at":"2026-01-05T21:00:46.059248-05:00","deleted_at":"2026-01-05T21:00:46.059248-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-1kw","title":"Fix triple snippet() calls in FTS search queries","description":"# Fix Triple snippet() Calls in Web UI Search\n\n## Problem\nHTTP mail UI search calls SQLite `snippet()` three times per row to compute hit counts, tripling FTS overhead.\n\n## Fix\n- Call `snippet()` once in SQL.\n- Compute `hits` in Python via `snippet.count('\u003cmark\u003e')`.\n\n## Acceptance criteria\n- Snippet text identical to current output.\n- Hit counts identical.\n- Search latency improves (tracked by benchmarks).\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T01:09:23.69685367-05:00","created_by":"ubuntu","updated_at":"2026-01-12T02:45:40.396925099-05:00","closed_at":"2026-01-12T02:45:40.396925099-05:00","close_reason":"Fixed triple snippet() calls - now calls snippet() once in SQL and computes hits in Python with .count('\u003cmark\u003e'). Verified output is identical."}
{"id":"mcp_agent_mail-21j","title":"Add LIMIT to potentially unbounded queries","description":"# Add Explicit Limits to Potentially Unbounded Queries (Non-breaking)\n\n## Problem\nSome queries use very large LIMITs (e.g., 10,000) or no limit at all. This can overfetch and waste memory.\n\n## Non-breaking requirement\nDefault behavior must remain **functionally identical**. If a limit is introduced, it must either:\n- preserve the existing default, or\n- be optional and only enforced when a caller specifies it.\n\n## Approach\n- Identify unbounded queries and add optional `limit` parameters to the **public tool endpoints** that surface them.\n- Keep current defaults (e.g., 10,000 for search UI) unless the caller supplies a smaller limit.\n- Enforce a **max limit** only when a caller explicitly passes a value (to avoid silent behavior changes).\n\n## Acceptance criteria\n- No change in default outputs for existing callers.\n- Optional limits reduce overfetch when provided.\n- Covered by E2E tests (default behavior) + unit tests (limit behavior).\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T01:12:24.387994975-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.262602756-05:00","closed_at":"2026-01-12T01:48:46.262602756-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-23f","title":"Unit Tests: guard.py - Pre-commit","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.481906-05:00","updated_at":"2026-01-05T21:00:46.98086-05:00","deleted_at":"2026-01-05T21:00:46.98086-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-24j","title":"Replace string normalization while loop with regex","description":"# Replace String Normalization While Loop with Regex\n\n## Problem\n`while \"  \" in trimmed: trimmed = trimmed.replace(\"  \", \" \")` scans the string repeatedly.\n\n## Constraint\nPreserve semantics: only collapse **multiple spaces**, not tabs/newlines.\n\n## Fix\nUse a single regex pass:\n```\ntrimmed = re.sub(r\" {2,}\", \" \", trimmed)\n```\n\n## Tests\n- Strings with multiple spaces collapse correctly\n- Tabs/newlines are unchanged\n","notes":"Starting regex replacement for space normalization loop.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:48.840958136-05:00","created_by":"ubuntu","updated_at":"2026-01-12T06:44:31.489420541-05:00","closed_at":"2026-01-12T06:44:31.489420541-05:00","close_reason":"Completed"}
{"id":"mcp_agent_mail-24o","title":"Integration Tests: Concurrent Access","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.486681-05:00","updated_at":"2026-01-05T21:00:45.888166-05:00","deleted_at":"2026-01-05T21:00:45.888166-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-24w","title":"P2 - Guard Hook Tests","description":"Test pre-commit and pre-push guards.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.867107-05:00","updated_at":"2026-01-05T21:02:37.56359-05:00","deleted_at":"2026-01-05T21:02:37.56359-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-2e4","title":"Integration Tests: Contact Management Flow","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.484957-05:00","updated_at":"2026-01-05T21:00:46.302378-05:00","deleted_at":"2026-01-05T21:00:46.302378-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-2qc","title":"P2 - CLI Integration Tests","description":"Test CLI commands work correctly.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.854864-05:00","updated_at":"2026-01-05T21:02:37.391256-05:00","deleted_at":"2026-01-05T21:02:37.391256-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-2rk","title":"Unit Tests: http.py - Rate Limiting","description":"priority: 3","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.480753-05:00","updated_at":"2026-01-05T21:00:47.069147-05:00","deleted_at":"2026-01-05T21:00:47.069147-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-2uf","title":"Phase 4: Cleanup and Polish","description":"# Phase 4: Cleanup and Polish\n\n## Goal\nAddress remaining low-impact inefficiencies and polish operations without changing behavior.\n\n## Scope\n- Stream large result sets (mcp_agent_mail-gt4)\n- Make large-query limits explicit \u0026 non-breaking (mcp_agent_mail-21j)\n- Review additional SQLite PRAGMAs (mcp_agent_mail-6m1)\n- Tune pool sizes via config (mcp_agent_mail-9zj)\n\n## Acceptance criteria\n- Phase 4 verification checkpoint passes (mcp_agent_mail-8pg)\n- No behavior/output changes\n","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-12T01:05:53.354148779-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:41:03.911695186-05:00","dependencies":[{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-vih","type":"blocks","created_at":"2026-01-12T01:06:18.812119619-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-gt4","type":"blocks","created_at":"2026-01-12T01:13:12.103227533-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-b11","type":"blocks","created_at":"2026-01-12T01:13:12.125274015-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-21j","type":"blocks","created_at":"2026-01-12T01:13:12.1485374-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-6m1","type":"blocks","created_at":"2026-01-12T01:13:12.172238549-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-9zj","type":"blocks","created_at":"2026-01-12T01:13:12.194594685-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-2uf","depends_on_id":"mcp_agent_mail-kfo","type":"blocks","created_at":"2026-01-12T01:21:26.855664865-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-2x6","title":"Unit Tests: storage.py - Inbox/Outbox","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.472327-05:00","updated_at":"2026-01-05T21:00:47.596135-05:00","deleted_at":"2026-01-05T21:00:47.596135-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-2xf","title":"Regression: Agent Name Validation","description":"priority: 0","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:02:17.831463-05:00","updated_at":"2026-01-05T21:43:01.516522-05:00","closed_at":"2026-01-05T21:43:01.516522-05:00","close_reason":"Completed: 38 regression tests for agent name validation covering validate_agent_name_format, generate_agent_name, sanitize_agent_name, and MCP integration flows in both coerce and strict modes"}
{"id":"mcp_agent_mail-3ph","title":"Test Coverage: Achieve 80% Overall","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.488404-05:00","updated_at":"2026-01-05T21:00:45.374664-05:00","deleted_at":"2026-01-05T21:00:45.374664-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-3x5","title":"CLI: Guard Commands","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.858346-05:00","updated_at":"2026-01-06T00:13:06.442902-05:00","closed_at":"2026-01-06T00:13:06.442902-05:00","close_reason":"26 tests pass for CLI Guard Commands (status, install, uninstall, check)","dependencies":[{"issue_id":"mcp_agent_mail-3x5","depends_on_id":"mcp_agent_mail-aew","type":"blocks","created_at":"2026-01-05T21:02:54.828161-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-47v","title":"Unit Tests: db.py - Session Management","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.468243-05:00","updated_at":"2026-01-05T21:00:48.679337-05:00","deleted_at":"2026-01-05T21:00:48.679337-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-48a","title":"Unit Tests: cli.py - Guard Commands","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.472972-05:00","updated_at":"2026-01-05T21:00:47.425206-05:00","deleted_at":"2026-01-05T21:00:47.425206-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-4em","title":"Performance: Baseline Benchmarks","description":"priority: 3","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:02:17.877976-05:00","updated_at":"2026-01-06T02:13:34.992751-05:00","closed_at":"2026-01-06T02:13:34.992751-05:00","close_reason":"Added MCP tool latency benchmarks: message send, inbox fetch, search, file reservation conflict check, archive write, and summary report. Tests use unique project keys and create_agent_identity for proper isolation. All tests pass with p95 thresholds.","dependencies":[{"issue_id":"mcp_agent_mail-4em","depends_on_id":"mcp_agent_mail-yzu","type":"blocks","created_at":"2026-01-05T21:02:55.70686-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-4qc","title":"Unit Tests: cli.py - Archive Commands","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.47394-05:00","updated_at":"2026-01-05T21:00:47.326503-05:00","deleted_at":"2026-01-05T21:00:47.326503-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-4yy","title":"Add composite database indexes for common query patterns","description":"# Add Composite Database Indexes for Common Query Patterns\n\n## Problem\nWe rely on multi-column filters and ORDER BY clauses. Single-column indexes force scans or index merges.\n\n## Target query patterns (from app.py/http.py)\n1. **Inbox**: MessageRecipient.agent_id + join Message.id + Message.project_id + ORDER BY Message.created_ts\n2. **Outbox**: Message.project_id + Message.sender_id + ORDER BY Message.created_ts\n3. **Active reservations**: FileReservation.project_id + released_ts IS NULL + expires_ts \u003e now\n4. **Agent listings**: Agent.project_id + name (already unique but verify)\n5. **Product links**: ProductProjectLink.product_id + project_id\n\n## Proposed indexes (verify with EXPLAIN)\n### MessageRecipient\n- `Index(\"ix_msgrecip_agent_message\", \"agent_id\", \"message_id\")`\n  - Speeds inbox fetches by agent_id and joins by message_id.\n\n### Message\n- `Index(\"ix_message_project_created\", \"project_id\", \"created_ts\")`\n- `Index(\"ix_message_project_sender_created\", \"project_id\", \"sender_id\", \"created_ts\")`\n  - Supports outbox and timeline ordering.\n\n### FileReservation\n- `Index(\"ix_fileres_project_released_expires\", \"project_id\", \"released_ts\", \"expires_ts\")`\n- `Index(\"ix_fileres_project_agent_released\", \"project_id\", \"agent_id\", \"released_ts\")`\n  - Supports active-only and agent-scoped reservation queries.\n\n### ProductProjectLink\n- `Index(\"ix_product_project\", \"product_id\", \"project_id\")`\n\n## Implementation notes\n- Add indexes via SQLModel `__table_args__` or SQLAlchemy `Index` declarations.\n- Keep index count minimal (write overhead).\n- Update any migration/bootstrapping path so new indexes are created.\n\n## Tests\n- Add a small EXPLAIN-based test (or query-plan sanity check) to ensure indexes are chosen.\n- Include in performance regression tests.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:57.068827018-05:00","created_by":"ubuntu","updated_at":"2026-01-12T05:29:52.684306704-05:00","closed_at":"2026-01-12T05:29:52.684306704-05:00","close_reason":"Added composite indexes in models + ensure_schema and expanded index existence test.","dependencies":[{"issue_id":"mcp_agent_mail-4yy","depends_on_id":"mcp_agent_mail-k92","type":"blocks","created_at":"2026-01-12T01:12:50.102341328-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-55z","title":"Test Coverage: Achieve 95% Overall","description":"priority: 3","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.488615-05:00","updated_at":"2026-01-05T21:00:45.283815-05:00","deleted_at":"2026-01-05T21:00:45.283815-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-59h","title":"Capture baseline performance metrics before optimization","description":"# Capture Baseline Performance Metrics (Pre-optimization)\n\n## Prerequisites\n- Instrumentation enabled (mcp_agent_mail-dbt)\n- E2E correctness suite ready (mcp_agent_mail-ab8)\n- Benchmark suite ready (mcp_agent_mail-k92)\n\n## What to capture\n1. Query counts per operation (send_message, fetch_inbox, list_outbox, search, summarize_thread)\n2. Latency percentiles (p50/p95/p99)\n3. Memory peaks (per benchmark)\n4. Throughput (ops/sec)\n\n## Output location\n- `docs/performance/baseline-metrics.md`\n- `tests/benchmarks/results/baseline-*.json`\n\n## Logging requirements\n- Rich summaries printed to console\n- JSON summaries for CI and future diffing\n\n## Acceptance criteria\nBaseline artifacts exist, are versioned, and can be compared post-change.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T01:18:50.342856972-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:36:57.241608301-05:00","dependencies":[{"issue_id":"mcp_agent_mail-59h","depends_on_id":"mcp_agent_mail-k92","type":"blocks","created_at":"2026-01-12T01:20:16.957047623-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-59h","depends_on_id":"mcp_agent_mail-ab8","type":"blocks","created_at":"2026-01-12T01:20:16.988252994-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-5cx","title":"Unit Tests: app.py - Core Helpers","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.468876-05:00","updated_at":"2026-01-05T21:00:48.514677-05:00","deleted_at":"2026-01-05T21:00:48.514677-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-6aq","title":"Test Coverage: Achieve 50% Overall","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.488157-05:00","updated_at":"2026-01-05T21:00:45.462014-05:00","deleted_at":"2026-01-05T21:00:45.462014-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-6m1","title":"Review and tune SQLite PRAGMA settings","description":"# Review SQLite PRAGMAs (Config-driven, safe defaults)\n\n## Current state\nWAL + synchronous=NORMAL + busy_timeout are already set. We should evaluate **additional** PRAGMAs that can improve performance without risking integrity.\n\n## Candidates to consider (configurable)\n- `cache_size` (negative = KiB) for larger caches\n- `temp_store=MEMORY` for faster temp tables\n- `mmap_size` for read-heavy workloads\n- `foreign_keys=ON` (ensure consistent behavior)\n\n## Constraints\n- Must be config-driven via .env (decouple pattern)\n- Safe defaults (no integrity regression)\n- Changes documented\n\n## Acceptance criteria\n- PRAGMAs are set explicitly and logged at startup\n- Benchmarks show measurable improvement (or revert)\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T01:12:24.57380359-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.26517536-05:00","closed_at":"2026-01-12T01:48:46.26517536-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-7a4","title":"P3 - Security Tests","description":"Test security-sensitive areas.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.869383-05:00","updated_at":"2026-01-05T21:02:37.650483-05:00","deleted_at":"2026-01-05T21:02:37.650483-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-7hm","title":"Create unit tests for all performance utility functions","description":"# Unit Tests for Performance Utility Functions\n\n## Purpose\nEach optimization introduces new helpers or modifies existing ones. We need **unit-level** tests that validate correctness, edge cases, and logging output.\n\n## Scope (update as utilities evolve)\n- `_get_agents_batch` mapping and missing-name handling\n- PathSpec pattern compilation cache\n- LRU cache behavior (eviction order, size bound)\n- String normalization helpers\n- Sort-key helper for stable ordering\n- File stat consolidation helper\n- Any new instrumentation helpers (query counters)\n\n## Logging requirements\n- Tests should assert both outputs **and** that logging hooks emit expected fields.\n- Use Rich console capture (or a test logger sink) to verify structured logs.\n\n## Acceptance criteria\n- Each helper has at least: happy path, edge case, and regression test.\n- Tests are deterministic and do not rely on wall clock except where explicitly mocked.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T01:20:56.862839163-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:36:32.889421183-05:00","dependencies":[{"issue_id":"mcp_agent_mail-7hm","depends_on_id":"mcp_agent_mail-dbt","type":"blocks","created_at":"2026-01-12T01:21:02.380860652-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-7pp","title":"Integration Tests: Full Messaging Flow","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.484043-05:00","updated_at":"2026-01-05T21:00:46.467406-05:00","deleted_at":"2026-01-05T21:00:46.467406-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-7ue","title":"Add serve-stdio command for stdio transport","description":"Add CLI command to run MCP server via stdio transport (requested in GitHub #41). This enables project-local installation patterns where Claude Code launches the server directly.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T23:39:36.679856-05:00","created_by":"jemanuel","updated_at":"2026-01-06T23:45:11.386347-05:00","closed_at":"2026-01-06T23:45:11.386347-05:00","close_reason":"Implemented serve-stdio command with test"}
{"id":"mcp_agent_mail-88l","title":"Unit Tests: llm.py - Provider Integration","description":"priority: 3","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.483764-05:00","updated_at":"2026-01-05T21:00:46.562021-05:00","deleted_at":"2026-01-05T21:00:46.562021-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-8hr","title":"Guards: Pre-push Enforcement","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.868497-05:00","updated_at":"2026-01-06T00:21:17.959806-05:00","closed_at":"2026-01-06T00:21:17.959806-05:00","close_reason":"Added 20 comprehensive pre-push enforcement tests covering hook rendering, env controls, conflict detection, pattern matching, multi-commit scenarios, and edge cases. All tests pass.","dependencies":[{"issue_id":"mcp_agent_mail-8hr","depends_on_id":"mcp_agent_mail-irp","type":"blocks","created_at":"2026-01-05T21:02:55.109306-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-8pg","title":"Phase 4 verification checkpoint - final validation and documentation","description":"# Phase 4 Verification Checkpoint (Final)\n\n## Must pass\n1. Full test suite: `pytest tests -v`\n2. E2E correctness: `pytest tests/e2e -v`\n3. Benchmarks: `pytest tests/benchmarks -v` (or gated CI run)\n\n## Phase 4 specific checks\n- Streaming uses bounded memory (tracemalloc check)\n- Query limits are configurable and non-breaking\n- PRAGMA and pool tuning are config-driven with safe defaults\n\n## Logging requirements\n- Rich summary output in console\n- JSON artifacts for CI comparison\n","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-12T01:19:54.351739379-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:41:16.03138302-05:00","dependencies":[{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-kfo","type":"blocks","created_at":"2026-01-12T01:20:21.040427679-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-gt4","type":"blocks","created_at":"2026-01-12T01:20:21.071761542-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-b11","type":"blocks","created_at":"2026-01-12T01:20:21.100692356-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-21j","type":"blocks","created_at":"2026-01-12T01:20:21.131102071-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-6m1","type":"blocks","created_at":"2026-01-12T01:20:21.16093396-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-9zj","type":"blocks","created_at":"2026-01-12T01:20:21.191280716-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-8pg","depends_on_id":"mcp_agent_mail-tty","type":"blocks","created_at":"2026-01-12T01:27:51.961222248-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-8rr","title":"Unit Tests: app.py - MCP Resources","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.470814-05:00","updated_at":"2026-01-05T21:00:47.866436-05:00","deleted_at":"2026-01-05T21:00:47.866436-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-9bz","title":"Milestone: Full Integration Coverage","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.881845-05:00","updated_at":"2026-01-06T01:04:04.832257-05:00","closed_at":"2026-01-06T01:04:04.832257-05:00","close_reason":"Full Integration Coverage achieved: CLI Guard Commands (26), HTTP Server/Transport (19), CLI Mail Commands (29), plus Critical Path Coverage milestone complete. All 74 core tests passing.","dependencies":[{"issue_id":"mcp_agent_mail-9bz","depends_on_id":"mcp_agent_mail-tm6","type":"blocks","created_at":"2026-01-05T21:02:57.199388-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-9bz","depends_on_id":"mcp_agent_mail-n6z","type":"blocks","created_at":"2026-01-05T21:02:57.30292-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-9bz","depends_on_id":"mcp_agent_mail-3x5","type":"blocks","created_at":"2026-01-05T21:02:57.404731-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-9bz","depends_on_id":"mcp_agent_mail-9z6","type":"blocks","created_at":"2026-01-05T21:02:57.494389-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-9he","title":"Unit Tests: app.py - Messaging","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.469601-05:00","updated_at":"2026-01-05T21:00:48.26081-05:00","deleted_at":"2026-01-05T21:00:48.26081-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-9sh","title":"Unit Tests: app.py - MCP Tools","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.471023-05:00","updated_at":"2026-01-05T21:00:47.765853-05:00","deleted_at":"2026-01-05T21:00:47.765853-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-9tj","title":"Add asyncio.Lock to rate limiter bucket access","description":"# Add Synchronization to Rate Limiter\n\n## Problem Statement\nThe token bucket rate limiter accesses shared state (bucket dict) without\nsynchronization, leading to potential race conditions under concurrent load.\n\n## Code Location\n`src/mcp_agent_mail/http.py` - Lines approximately 306-314\n\n## Current Code (THE PROBLEM)\n```python\nclass TokenBucketRateLimiter:\n    def __init__(self, rate: float, burst: int):\n        self._rate = rate\n        self._burst = burst\n        self._buckets: dict[str, tuple[float, float]] = {}  # No lock!\n    \n    async def check(self, key: str) -\u003e bool:\n        now = time.monotonic()\n        tokens, last_ts = self._buckets.get(key, (float(self._burst), now))\n        \n        # Time-based token replenishment\n        elapsed = now - last_ts\n        tokens = min(float(self._burst), tokens + elapsed * self._rate)\n        \n        if tokens \u003e= 1.0:\n            tokens -= 1.0\n            self._buckets[key] = (tokens, now)  # Race condition!\n            return True\n        \n        self._buckets[key] = (tokens, now)\n        return False\n```\n\n## Race Condition Scenario\n1. Request A reads bucket: tokens=1.0\n2. Request B reads bucket: tokens=1.0 (before A writes)\n3. Request A writes: tokens=0.0\n4. Request B writes: tokens=0.0\n5. Both requests allowed, but should have been 1 allowed, 1 denied!\n\n## Impact Analysis\n- Under concurrent load, rate limits can be exceeded\n- Security/DoS implications if rate limiting is for protection\n- Subtle bug - may only manifest under high concurrency\n\n## Required Fix\n```python\nimport asyncio\n\nclass TokenBucketRateLimiter:\n    def __init__(self, rate: float, burst: int):\n        self._rate = rate\n        self._burst = burst\n        self._buckets: dict[str, tuple[float, float]] = {}\n        self._lock = asyncio.Lock()  # Add lock\n    \n    async def check(self, key: str) -\u003e bool:\n        async with self._lock:  # Synchronize access\n            now = time.monotonic()\n            tokens, last_ts = self._buckets.get(key, (float(self._burst), now))\n            \n            elapsed = now - last_ts\n            tokens = min(float(self._burst), tokens + elapsed * self._rate)\n            \n            if tokens \u003e= 1.0:\n                tokens -= 1.0\n                self._buckets[key] = (tokens, now)\n                return True\n            \n            self._buckets[key] = (tokens, now)\n            return False\n```\n\n## Performance Consideration\nA single global lock may be too coarse if there are many independent keys.\nConsider per-key locking for better concurrency:\n\n```python\nclass TokenBucketRateLimiter:\n    def __init__(self, rate: float, burst: int):\n        self._rate = rate\n        self._burst = burst\n        self._buckets: dict[str, tuple[float, float]] = {}\n        self._locks: dict[str, asyncio.Lock] = {}\n        self._locks_lock = asyncio.Lock()  # Lock for creating locks\n    \n    async def _get_lock(self, key: str) -\u003e asyncio.Lock:\n        if key not in self._locks:\n            async with self._locks_lock:\n                if key not in self._locks:  # Double-check\n                    self._locks[key] = asyncio.Lock()\n        return self._locks[key]\n    \n    async def check(self, key: str) -\u003e bool:\n        lock = await self._get_lock(key)\n        async with lock:\n            # ... rate limit logic\n```\n\n## Testing Strategy\n1. Unit test: Single request succeeds\n2. Unit test: Burst requests up to limit succeed\n3. Unit test: Request after burst denied\n4. Concurrency test: Many concurrent requests don't exceed limit\n5. Stress test: High concurrency doesn't cause errors\n\n## Verification\n```python\nimport asyncio\n\nlimiter = TokenBucketRateLimiter(rate=10, burst=10)\n\nasync def hammer(n_requests: int) -\u003e int:\n    \"\"\"Make many concurrent requests, count allowed.\"\"\"\n    tasks = [limiter.check(\"test-key\") for _ in range(n_requests)]\n    results = await asyncio.gather(*tasks)\n    return sum(results)\n\n# Should allow at most burst (10) requests\nallowed = asyncio.run(hammer(100))\nassert allowed \u003c= 10, f\"Rate limit exceeded: {allowed} \u003e 10\"\n```\n\n## Dependencies\nNone - self-contained fix","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:52.411836481-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:35:03.164530218-05:00","closed_at":"2026-01-12T01:35:03.164530218-05:00","close_reason":"In-memory rate limiter path is synchronous within the event loop; no await between read/write, so no race."}
{"id":"mcp_agent_mail-9z5","title":"HTTP: Rate Limiting","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.865169-05:00","updated_at":"2026-01-06T00:43:39.507538-05:00","closed_at":"2026-01-06T00:43:39.507538-05:00","close_reason":"Added 13 comprehensive rate limiting tests covering token bucket, burst, refill, Redis backend, per-identity keying, and edge cases. All tests pass."}
{"id":"mcp_agent_mail-9z6","title":"HTTP: Server and Transport","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.86218-05:00","updated_at":"2026-01-06T00:27:46.401925-05:00","closed_at":"2026-01-06T00:27:46.401925-05:00","close_reason":"19 HTTP server/transport tests implemented and passing: config, health, SSE, tool calls, resources, CORS, error handling"}
{"id":"mcp_agent_mail-9zj","title":"Tune connection pool size based on workload","description":"# Tune Connection Pool Size (Config-driven)\n\n## Current state\nSQLite pools are already set to conservative defaults in db.py. We need to make these **configurable** and validate with benchmarks.\n\n## Requirements\n- Expose `pool_size`, `max_overflow`, `pool_timeout`, `pool_recycle` via .env\n- Keep current values as defaults (non-breaking)\n- Add benchmark data to justify any changes\n\n## Acceptance criteria\n- Config options documented\n- Benchmarks show improved throughput under realistic concurrency\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T01:12:24.745350248-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.268167273-05:00","closed_at":"2026-01-12T01:48:46.268167273-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-ab8","title":"Create E2E correctness validation test suite for proving isomorphism","description":"# E2E Correctness Validation Suite (Isomorphism Proof)\n\n## Purpose\nBefore any optimization, we must capture **exact outputs** for representative workflows and compare to golden files after changes. This is the proof of isomorphism.\n\n## Principles\n- Deterministic test data (fixed timestamps, seeded randomness)\n- Full-fidelity outputs (no lossy normalization)\n- Rich, human-readable logs alongside machine assertions\n\n## Coverage (minimum)\n1. **Identity lifecycle**: ensure_project, register_agent, whois\n2. **Messaging lifecycle**: send_message (to/cc/bcc), attachments (inline + file), read/ack flows\n3. **Inbox/outbox**: fetch_inbox, mailbox, outbox with limits and since_ts\n4. **Search + snippets**: FTS + LIKE fallback behavior\n5. **File reservations**: create/renew/release, conflict detection\n6. **Contact links**: request/approve/deny + cross-project messaging\n7. **Product bus**: ensure_product, products_link, product inbox/thread summary\n8. **Share export**: export + verify + preview (dry-run outputs only)\n\n## Logging requirements\n- Use Rich panels/tables for each test phase (setup, action, assertion)\n- Emit structured JSON alongside Rich for CI (capture to `tests/e2e/logs/`)\n- Log tool responses and diffs when mismatch is detected\n\n## Golden files\n- Store canonical outputs under `tests/e2e/golden/` with stable ordering.\n- Include message bodies, recipients, metadata, and snippets.\n- Include a diff helper that prints field-level differences for failures.\n\n## Acceptance criteria\n- E2E suite passes before and after optimizations with identical outputs.\n- Any behavior change causes a visible diff and fails CI.\n","notes":"Stabilized E2E suite outputs (contacts, reservations, commits), updated golden; ruff+ty clean; test passes locally.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:18:13.841542732-05:00","created_by":"ubuntu","updated_at":"2026-01-12T06:39:58.502105338-05:00","closed_at":"2026-01-12T06:39:58.502105338-05:00","close_reason":"Completed","dependencies":[{"issue_id":"mcp_agent_mail-ab8","depends_on_id":"mcp_agent_mail-dbt","type":"blocks","created_at":"2026-01-12T01:20:16.927525747-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-ada","title":"Unit Tests: app.py - Agent Operations","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.469373-05:00","updated_at":"2026-01-05T21:00:48.350222-05:00","deleted_at":"2026-01-05T21:00:48.350222-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-aea","title":"Errors: Database Failures","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.851404-05:00","updated_at":"2026-01-06T00:21:22.479073-05:00","closed_at":"2026-01-06T00:21:22.479073-05:00","close_reason":"Created tests/test_database_failures.py with 20 tests covering database auto-creation, retry_on_db_lock decorator, transaction rollback, session cleanup, and SQLite configuration (WAL mode, busy_timeout, synchronous mode)","dependencies":[{"issue_id":"mcp_agent_mail-aea","depends_on_id":"mcp_agent_mail-mm2","type":"blocks","created_at":"2026-01-05T21:02:54.533343-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-aew","title":"Core: File Reservation Lifecycle","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.836703-05:00","updated_at":"2026-01-05T22:02:46.295934-05:00","closed_at":"2026-01-05T22:02:46.295934-05:00","close_reason":"17 tests (16 pass, 1 skip) covering: create exclusive/shared reservations, conflict detection (ex-ex, ex-sh, sh-sh), pattern overlap, TTL, manual release, renew, force release, multiple paths, git artifacts"}
{"id":"mcp_agent_mail-aid","title":"Fix N+1 pattern in _list_inbox() recipient fetching","description":"# Fix N+1 Query Pattern in _list_inbox()\n\n## Problem Statement\nSimilar to _list_outbox(), the inbox listing likely fetches recipients per-message,\ncausing N+1 query behavior.\n\n## Code Location\n`src/mcp_agent_mail/app.py` - Search for \"_list_inbox\" or \"fetch_inbox\"\n\n## Investigation Required\n1. Find the inbox listing implementation\n2. Verify it has the same N+1 pattern as outbox\n3. Apply the same fix pattern\n\n## Expected Fix Pattern\nSame as _list_outbox:\n1. Collect all message IDs\n2. Single query for all recipients: `WHERE message_id IN (...)`\n3. Group results by message_id using defaultdict\n4. Use pre-fetched data in the message loop\n\n## Testing Strategy\nSame as _list_outbox tests but for inbox endpoint.\n\n## Dependencies\n- Should be done alongside or after _list_outbox fix to ensure consistency\n\n## Note\nThis task exists because the analysis identified N+1 patterns in outbox listing.\nInbox almost certainly has the same pattern since the code is likely similar.\nVerify during implementation.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:10.291628635-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:34:47.090263244-05:00","closed_at":"2026-01-12T01:34:47.090263244-05:00","close_reason":"Already single-query join in _list_inbox(); no N+1 to fix.","dependencies":[{"issue_id":"mcp_agent_mail-aid","depends_on_id":"mcp_agent_mail-jxj","type":"blocks","created_at":"2026-01-12T01:13:19.430013059-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-aop","title":"Milestones","description":"---","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.88018-05:00","updated_at":"2026-01-05T21:02:38.054787-05:00","deleted_at":"2026-01-05T21:02:38.054787-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-aqs","title":"E2E: Multi-Agent Development Workflow","description":"priority: 4","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-05T21:02:17.878946-05:00","updated_at":"2026-01-06T02:13:22.627246-05:00","closed_at":"2026-01-06T02:13:22.627246-05:00","close_reason":"9 E2E tests implemented and passing (test_e2e_multi_agent_workflow.py)","dependencies":[{"issue_id":"mcp_agent_mail-aqs","depends_on_id":"mcp_agent_mail-n6z","type":"blocks","created_at":"2026-01-05T21:02:56.043931-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-aqs","depends_on_id":"mcp_agent_mail-irp","type":"blocks","created_at":"2026-01-05T21:02:56.345936-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-az3","title":"Implement read-write lock for schema operations","description":"# Implement Read-Write Lock for Schema Operations\n\n## Problem Statement\nSchema operations use a single coarse-grained lock, preventing concurrent\nreads even when no writes are happening.\n\n## Code Location\n`src/mcp_agent_mail/db.py` - Lines approximately 235-251\n\n## Current Code (THE PROBLEM)\n```python\n# Single lock for ALL schema operations\n_schema_lock = asyncio.Lock()\n\nasync def ensure_schema():\n    async with _schema_lock:  # Blocks ALL concurrent schema ops\n        # Check if schema exists\n        # Create tables if needed\n        pass\n\nasync def get_schema_version():\n    async with _schema_lock:  # Even reads block each other!\n        # Just reading version\n        pass\n```\n\n## Impact Analysis\n- Multiple agents checking schema version block each other\n- Read operations don't need exclusive access\n- Write operations (schema creation/migration) are rare\n- Current lock is write-lock for all operations\n\n## Required Fix\nImplement a read-write lock:\n\n```python\nimport asyncio\nfrom contextlib import asynccontextmanager\n\nclass AsyncRWLock:\n    \"\"\"Async read-write lock allowing concurrent reads, exclusive writes.\"\"\"\n    \n    def __init__(self):\n        self._read_count = 0\n        self._read_lock = asyncio.Lock()\n        self._write_lock = asyncio.Lock()\n    \n    @asynccontextmanager\n    async def read_lock(self):\n        \"\"\"Acquire read lock - multiple readers allowed.\"\"\"\n        async with self._read_lock:\n            self._read_count += 1\n            if self._read_count == 1:\n                await self._write_lock.acquire()\n        try:\n            yield\n        finally:\n            async with self._read_lock:\n                self._read_count -= 1\n                if self._read_count == 0:\n                    self._write_lock.release()\n    \n    @asynccontextmanager\n    async def write_lock(self):\n        \"\"\"Acquire write lock - exclusive access.\"\"\"\n        await self._write_lock.acquire()\n        try:\n            yield\n        finally:\n            self._write_lock.release()\n\n\n# Usage\n_schema_rwlock = AsyncRWLock()\n\nasync def ensure_schema():\n    async with _schema_rwlock.write_lock():  # Exclusive\n        # Schema modification\n        pass\n\nasync def get_schema_version():\n    async with _schema_rwlock.read_lock():  # Shared\n        # Just reading\n        pass\n```\n\n## RWLock Properties\n- Multiple readers can hold read_lock simultaneously\n- Writer waits for all readers to release\n- Readers wait for writer to release\n- Prevents writer starvation (new readers don't queue-jump waiting writer)\n\n## Alternative: Use Existing Library\n```python\nfrom aiorwlock import RWLock  # pip install aiorwlock\n\n_schema_lock = RWLock()\n\nasync def read_schema():\n    async with _schema_lock.reader:\n        ...\n\nasync def write_schema():\n    async with _schema_lock.writer:\n        ...\n```\n\n## Testing Strategy\n1. Multiple concurrent reads succeed simultaneously\n2. Write blocks new reads\n3. Reads block writes until complete\n4. No deadlocks under stress\n\n## Verification\n```python\nimport asyncio\nimport time\n\nrwlock = AsyncRWLock()\nread_times = []\n\nasync def reader(id: int):\n    start = time.perf_counter()\n    async with rwlock.read_lock():\n        await asyncio.sleep(0.1)  # Simulate read\n    read_times.append(time.perf_counter() - start)\n\n# Run 10 concurrent readers\nasyncio.run(asyncio.gather(*[reader(i) for i in range(10)]))\n\n# With RWLock: All readers finish in ~0.1s (parallel)\n# With plain Lock: Takes ~1.0s (serial)\ntotal_time = max(read_times)\nassert total_time \u003c 0.2, f\"Reads should be parallel: {total_time:.3f}s\"\n```\n\n## Dependencies\nNone - self-contained implementation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:53.813736679-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:35:12.186142859-05:00","closed_at":"2026-01-12T01:35:12.186142859-05:00","close_reason":"Schema lock is only used during first-time ensure_schema(); no concurrent read ops to justify RW lock."}
{"id":"mcp_agent_mail-b11","title":"Fix process lock dict memory leak - add cleanup","description":"# Fix Process Lock Dictionary Memory Leak\n\n## Problem Statement\nThe process lock dictionary grows unboundedly as new lock keys are added\nbut never removed, even after the operations complete.\n\n## Code Location\nSearch for lock dictionary usage in storage.py or db.py.\n\n## Current Code (THE PROBLEM)\n```python\n_process_locks: dict[str, asyncio.Lock] = {}\n\nasync def get_lock(key: str) -\u003e asyncio.Lock:\n    if key not in _process_locks:\n        _process_locks[key] = asyncio.Lock()\n    return _process_locks[key]\n\n# Locks are never removed!\n# After 10,000 unique keys, dict has 10,000 entries\n```\n\n## Impact Analysis\n- Each Lock object is ~100 bytes\n- 10,000 unique lock keys = ~1MB leaked\n- Over long-running server lifetime, can grow significantly\n- Also pollutes dict lookup performance\n\n## Required Fix Options\n\n### Option 1: WeakValueDictionary (Automatic Cleanup)\n```python\nfrom weakref import WeakValueDictionary\n\n_process_locks: WeakValueDictionary[str, asyncio.Lock] = WeakValueDictionary()\n\n# Locks automatically removed when no longer referenced\n```\n\n**Caveat**: Lock might be GC'd between get and use. Need careful handling.\n\n### Option 2: LRU Dict with Expiry\n```python\nfrom collections import OrderedDict\nimport time\n\nclass ExpiringLockDict:\n    def __init__(self, max_age: float = 3600, max_size: int = 10000):\n        self._locks: OrderedDict[str, tuple[asyncio.Lock, float]] = OrderedDict()\n        self._max_age = max_age\n        self._max_size = max_size\n    \n    def get(self, key: str) -\u003e asyncio.Lock:\n        self._cleanup()\n        if key in self._locks:\n            lock, _ = self._locks[key]\n            self._locks.move_to_end(key)\n            self._locks[key] = (lock, time.monotonic())\n            return lock\n        lock = asyncio.Lock()\n        self._locks[key] = (lock, time.monotonic())\n        return lock\n    \n    def _cleanup(self):\n        now = time.monotonic()\n        # Remove expired\n        while self._locks:\n            key, (lock, ts) = next(iter(self._locks.items()))\n            if now - ts \u003e self._max_age and not lock.locked():\n                self._locks.pop(key)\n            else:\n                break\n        # Remove oldest if over size\n        while len(self._locks) \u003e self._max_size:\n            key, (lock, _) = self._locks.popitem(last=False)\n            if lock.locked():\n                # Don't remove locked locks, put back\n                self._locks[key] = (lock, time.monotonic())\n                break\n```\n\n### Option 3: Explicit Release\n```python\n@asynccontextmanager\nasync def acquire_lock(key: str):\n    lock = _process_locks.setdefault(key, asyncio.Lock())\n    try:\n        await lock.acquire()\n        yield lock\n    finally:\n        lock.release()\n        # Clean up if no waiters\n        if key in _process_locks and not lock.locked():\n            del _process_locks[key]\n```\n\n## Recommended Approach\nOption 2 (LRU with expiry) is safest:\n- Bounded size prevents unbounded growth\n- Expiry handles inactive keys\n- Doesn't remove actively-used locks\n\n## Testing Strategy\n1. Create 10,000 unique lock keys\n2. Verify dict size stays bounded\n3. Verify old unused keys are cleaned up\n4. Verify active locks are not removed\n5. Memory profile over extended run\n\n## Verification\n```python\nlock_dict = ExpiringLockDict(max_age=1.0, max_size=100)\n\n# Create many locks\nfor i in range(1000):\n    lock_dict.get(f\"key-{i}\")\n\n# Size should be bounded\nassert len(lock_dict._locks) \u003c= 100\n\n# Wait for expiry\nawait asyncio.sleep(2.0)\nlock_dict.get(\"trigger-cleanup\")\n\n# Old locks should be cleaned\nassert len(lock_dict._locks) \u003c 50\n```\n\n## Dependencies\nNone - self-contained fix","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T01:12:24.227385301-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:35:19.949015985-05:00","closed_at":"2026-01-12T01:35:19.949015985-05:00","close_reason":"Process-lock dict entries are cleaned on __aexit__/error paths; no unbounded growth seen."}
{"id":"mcp_agent_mail-b41","title":"Unit Tests: db.py - Migrations","description":"priority: 3","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.468601-05:00","updated_at":"2026-01-05T21:00:48.597636-05:00","deleted_at":"2026-01-05T21:00:48.597636-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-bko","title":"Unit Tests: http.py - Server Setup","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.475868-05:00","updated_at":"2026-01-05T21:00:47.240944-05:00","deleted_at":"2026-01-05T21:00:47.240944-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-c2x","title":"Errors: Git Archive Failures","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.85316-05:00","updated_at":"2026-01-06T00:36:13.482789-05:00","closed_at":"2026-01-06T00:36:13.482789-05:00","close_reason":"Added 21 comprehensive tests for Git archive failure handling covering auto-creation, repo initialization, concurrent writes, lock healing, file path sanitization, and large attachments. All tests pass.","dependencies":[{"issue_id":"mcp_agent_mail-c2x","depends_on_id":"mcp_agent_mail-mm2","type":"blocks","created_at":"2026-01-05T21:02:54.631277-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-ctq","title":"Milestone: Production Ready","description":"priority: 3","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.882507-05:00","updated_at":"2026-01-06T02:10:13.146794-05:00","closed_at":"2026-01-06T02:10:13.146794-05:00","close_reason":"All dependencies satisfied: Full Integration Coverage (74 tests), Concurrency (13 tests), Security Input Sanitization (28 tests). Production ready milestone complete.","dependencies":[{"issue_id":"mcp_agent_mail-ctq","depends_on_id":"mcp_agent_mail-9bz","type":"blocks","created_at":"2026-01-05T21:02:57.578989-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-ctq","depends_on_id":"mcp_agent_mail-yh8","type":"blocks","created_at":"2026-01-05T21:02:57.684143-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-ctq","depends_on_id":"mcp_agent_mail-e4m","type":"blocks","created_at":"2026-01-05T21:02:57.801425-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-cyw","title":"Fix N+1 query pattern in _deliver_message() agent lookups","description":"# Fix N+1 Query Pattern in _deliver_message() Agent Lookups\n\n## Problem\nWhen sending to many recipients, `_deliver_message()` calls `_get_agent()` per name (TO/CC/BCC), resulting in N separate SELECTs.\n\n## Fix strategy\n- Use `_get_agents_batch()` for each recipient list (or one combined list, then split by kind).\n- Preserve **exact** error semantics for missing names (placeholder detection, suggestions, available agents).\n- Preserve auto-registration and contact-handshake behavior in send_message flow.\n\n## Acceptance criteria\n- One query for all recipient lookups (per project).\n- Outputs unchanged for all send_message scenarios.\n- Covered by E2E correctness tests and query-count assertions.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:08.40582703-05:00","created_by":"ubuntu","updated_at":"2026-01-12T05:22:19.644193592-05:00","closed_at":"2026-01-12T05:22:19.644193592-05:00","close_reason":"Swapped recipient lookups to _get_agents_batch and added query-count regression test for multi-recipient send.","dependencies":[{"issue_id":"mcp_agent_mail-cyw","depends_on_id":"mcp_agent_mail-dwu","type":"blocks","created_at":"2026-01-12T01:12:50.014777861-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-dbt","title":"Build query counting and performance instrumentation infrastructure","description":"# Query Counting + Performance Instrumentation Infrastructure\n\n## Why this comes first\nWe cannot prove N+1 eliminations or performance gains without hard numbers. This provides:\n- Query counts per tool call\n- Latency timing per tool call\n- Optional memory snapshots\n- Structured, rich logging for humans\n\n## Design constraints\n- **Isomorphic only**: instrumentation must not change behavior.\n- **Low overhead when disabled**: no-op fast path.\n- **Config-driven** (decouple): on/off and sampling via .env.\n- **Avoid file proliferation**: prefer a single new module only if needed; otherwise extend existing modules.\n\n## Required components\n1. **SQLAlchemy query counter**\n   - Use event listeners on `engine.sync_engine` (before_cursor_execute/after_cursor_execute).\n   - Store counts in `contextvars.ContextVar` scoped to a tool invocation.\n   - Track total queries + per-table counts + slow-query thresholds.\n\n2. **Tool timing wrapper**\n   - Hook into existing `_instrument_tool` in `app.py`.\n   - Capture wall time, query count, and (optional) memory delta.\n   - Emit structured logs and optional metrics snapshots.\n\n3. **Rich logging output**\n   - Use Rich panels/tables showing query counts and timings per tool call.\n   - Provide a terse JSON log alternative for machine ingestion.\n\n4. **Test hooks**\n   - Expose helpers so tests can assert query counts, e.g. `track_queries()` context manager.\n   - Must work under pytest asyncio.\n\n## Acceptance criteria\n- Query counts available in tests and logs for key tools (send_message, fetch_inbox, list_outbox, summarize_thread, search).\n- No behavior changes when instrumentation disabled.\n- Clear on/off controls via .env.\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:17:31.410538742-05:00","created_by":"ubuntu","updated_at":"2026-01-12T03:17:11.571058299-05:00","closed_at":"2026-01-12T03:17:11.571058299-05:00","close_reason":"Completed instrumentation + query tracking hooks + rich logging + test hooks"}
{"id":"mcp_agent_mail-dcy","title":"Fix N+1 in summarize_thread() - batch message and recipient fetching","description":"# Fix N+1 in summarize_thread()\n\n## Problem Statement\nThread summarization likely fetches messages and their recipients in a loop,\ncausing N+1 query patterns similar to inbox/outbox listing.\n\n## Code Location\n`src/mcp_agent_mail/app.py` - Search for \"summarize_thread\" function\n\n## Investigation Required\n1. Find the summarize_thread implementation\n2. Trace the data access patterns\n3. Identify N+1 loops (per-message queries for participants, recipients, etc.)\n\n## Expected Issues\nBased on analysis, summarize_thread likely:\n- Fetches all messages in a thread (1 query - OK)\n- For each message, fetches sender info (N queries - BAD)\n- For each message, fetches recipients (N queries - BAD)\n- For each message, fetches read/ack status (N queries - BAD)\n\n## Fix Pattern\nSame as other N+1 fixes:\n1. Collect all message IDs from the thread\n2. Batch fetch all related data:\n   - All senders: `WHERE id IN (sender_ids)`\n   - All recipients: `WHERE message_id IN (message_ids)`\n   - All read statuses: `WHERE message_id IN (message_ids)`\n3. Build lookup dicts from results\n4. Assemble thread summary using lookups\n\n## Performance Impact\nA thread with 50 messages currently issues 50-150 queries.\nAfter fix: 4-5 queries total regardless of thread size.\n\n## Testing Strategy\n1. Create thread with 1 message, verify query count\n2. Create thread with 20 messages, verify still ~5 queries\n3. Verify summary output is identical before/after\n\n## Dependencies\n- Requires _get_agents_batch for sender lookups\n- Similar pattern to inbox/outbox fixes","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:58.023043838-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:34:55.071069515-05:00","closed_at":"2026-01-12T01:34:55.071069515-05:00","close_reason":"summarize_thread already uses a single joined query; no per-message DB lookups observed.","dependencies":[{"issue_id":"mcp_agent_mail-dcy","depends_on_id":"mcp_agent_mail-dwu","type":"blocks","created_at":"2026-01-12T01:12:50.037727325-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-dvk","title":"Unit Tests: app.py - Project Operations","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.469149-05:00","updated_at":"2026-01-05T21:00:48.431232-05:00","deleted_at":"2026-01-05T21:00:48.431232-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-dwu","title":"Create batched agent lookup function (_get_agents_batch)","description":"# Create Batched Agent Lookup Function (_get_agents_batch)\n\n## Problem\n`_get_agent()` performs a single lookup; send_message and other flows call it N times. We need a batched path that preserves `_get_agent` semantics (case-insensitive match, helpful error messages).\n\n## Requirements\n- Accept project + list of names\n- Case-insensitive lookup\n- Return dict `name -\u003e Agent` using original requested name as key\n- If any names are missing, produce **the same quality error** as `_get_agent` (suggestions, available list, placeholder detection)\n  - For missing names, you may call `_get_agent` **only for missing entries** to reuse error logic\n\n## Suggested API\n```python\nasync def _get_agents_batch(project: Project, names: Sequence[str]) -\u003e dict[str, Agent]:\n    ...\n```\n\n## Implementation notes\n- Deduplicate names to avoid extra work.\n- Use a single query: `WHERE project_id = ? AND lower(name) IN (...)`.\n- Map results back to requested casing.\n\n## Tests\n- Empty list returns {}\n- Mixed-case lookup works\n- Missing name raises same error as `_get_agent`\n- Placeholder names trigger CONFIGURATION_ERROR\n","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:07.828287763-05:00","created_by":"ubuntu","updated_at":"2026-01-12T05:14:51.862807734-05:00","closed_at":"2026-01-12T05:14:51.862807734-05:00","close_reason":"Added _get_agents_batch with deduped case-insensitive lookup and tests for empty/mixed-case/missing/placeholder.","dependencies":[{"issue_id":"mcp_agent_mail-dwu","depends_on_id":"mcp_agent_mail-k92","type":"blocks","created_at":"2026-01-12T01:12:50.081521085-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-e4m","title":"Concurrency: Multiple Agents","description":"priority: 3","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:02:17.876769-05:00","updated_at":"2026-01-06T02:19:46.303396-05:00","closed_at":"2026-01-06T02:19:46.303396-05:00","close_reason":"13 concurrency tests pass: agent registration, message sending, file reservation conflicts, inbox fetching, archive writes, deadlock prevention, race conditions. Tests made resilient to transient async failures.","dependencies":[{"issue_id":"mcp_agent_mail-e4m","depends_on_id":"mcp_agent_mail-uvf","type":"blocks","created_at":"2026-01-05T21:02:55.413216-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-e4m","depends_on_id":"mcp_agent_mail-aew","type":"blocks","created_at":"2026-01-05T21:02:55.576713-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-e5d","title":"Re-run full pytest after summarize_thread key_points merge","description":"Full pytest run failed in tests/test_server.py. After fixing summarize_thread key_points merge, only targeted test was rerun. Re-run full pytest to confirm no regressions.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T04:52:44.061282893-05:00","created_by":"ubuntu","updated_at":"2026-01-12T04:52:44.061282893-05:00"}
{"id":"mcp_agent_mail-e9z","title":"P4 - E2E Scenario Tests","description":"Complete end-to-end scenarios.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.878396-05:00","updated_at":"2026-01-05T21:02:37.963853-05:00","deleted_at":"2026-01-05T21:02:37.963853-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-enu","title":"CLI: Archive Commands","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.859253-05:00","updated_at":"2026-01-05T23:39:38.961247-05:00","closed_at":"2026-01-05T23:39:38.961247-05:00","close_reason":"24 comprehensive CLI archive command tests added and passing","dependencies":[{"issue_id":"mcp_agent_mail-enu","depends_on_id":"mcp_agent_mail-uvf","type":"blocks","created_at":"2026-01-05T21:02:54.9184-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-f26","title":"Unit Tests: share.py - Archive Save","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.483229-05:00","updated_at":"2026-01-05T21:00:46.787388-05:00","deleted_at":"2026-01-05T21:00:46.787388-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-fuj","title":"Integration Tests: File Reservation Conflicts","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.484292-05:00","updated_at":"2026-01-05T21:00:46.383572-05:00","deleted_at":"2026-01-05T21:00:46.383572-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-g77","title":"Fix LRU cache O(n) operations - replace list with OrderedDict","description":"# Fix LRU Cache O(n) Operations in _LRURepoCache\n\n## Problem\n`_LRURepoCache` maintains `_order` as a list. Each cache hit does `list.remove()` (O(n)). Under heavy load this scales poorly.\n\n## Fix\n- Replace `_order` list with `collections.OrderedDict` (or `dict` + `move_to_end` in Py3.14).\n- Use `move_to_end` on access to maintain LRU ordering in O(1).\n- Keep eviction semantics identical.\n\n## Acceptance criteria\n- Cache hit is O(1)\n- Behavior unchanged (same eviction order)\n- Unit tests cover eviction and reuse\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:07:57.207854635-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.257302808-05:00","closed_at":"2026-01-12T01:48:46.257302808-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-gt4","title":"Replace fetchall() with cursor iteration for large result sets","description":"# Replace fetchall() with Streaming for Large Result Sets\n\n## Problem\n`fetchall()` loads full results into memory. For large datasets this causes memory spikes.\n\n## Target areas\n- Web UI listing routes that can return large sets\n- Export/snapshot flows\n- Any query without a small, explicit limit\n\n## Fix\nUse `session.stream()` or `stream_scalars()` and iterate rows incrementally.\n\n## Acceptance criteria\n- Memory usage bounded (validated with tracemalloc tests)\n- Output identical to current behavior\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T01:12:23.423590282-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.260037306-05:00","closed_at":"2026-01-12T01:48:46.260037306-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-h1m","title":"P1 - Core Functionality Tests","description":"These test the primary user-facing functionality.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.834592-05:00","updated_at":"2026-01-05T21:02:37.107921-05:00","deleted_at":"2026-01-05T21:02:37.107921-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-h4o","title":"Add @lru_cache to PathSpec pattern compilation","description":"# Cache PathSpec Pattern Compilation\n\n## Problem\n`_patterns_overlap()` compiles PathSpec for every call. This is expensive in file reservation conflict checks.\n\n## Fix\n- Introduce a small helper, e.g. `_compile_pathspec(pattern)` with `@lru_cache(maxsize=1024)`.\n- Normalize patterns (slash + strip) before caching to improve hit ratio.\n- When PathSpec is unavailable, short-circuit to fnmatch (no cache needed).\n\n## Tests\n- Verify caching improves hit/miss ratio\n- Ensure behavior identical for overlap detection\n","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-12T01:09:21.988589258-05:00","created_by":"ubuntu","updated_at":"2026-01-12T02:46:06.936021128-05:00"}
{"id":"mcp_agent_mail-hqk","title":"MCP Resources: Read Access","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.843304-05:00","updated_at":"2026-01-05T22:46:29.773477-05:00","closed_at":"2026-01-05T22:46:29.773477-05:00","close_reason":"Completed P1 MCP Resources Read Access tests - 18 tests covering project, agents, inbox, outbox, thread, and file_reservations resources","dependencies":[{"issue_id":"mcp_agent_mail-hqk","depends_on_id":"mcp_agent_mail-mm2","type":"blocks","created_at":"2026-01-05T21:02:54.329922-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-i0u","title":"E2E Test Script: Multi-Agent Workflow","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.486948-05:00","updated_at":"2026-01-05T21:00:45.7694-05:00","deleted_at":"2026-01-05T21:00:45.7694-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-i3n","title":"Integration Tests: Guard Pre-commit","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.485595-05:00","updated_at":"2026-01-05T21:00:46.147751-05:00","deleted_at":"2026-01-05T21:00:46.147751-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-i8h","title":"E2E Test Script: Disaster Recovery","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.487445-05:00","updated_at":"2026-01-05T21:00:45.650175-05:00","deleted_at":"2026-01-05T21:00:45.650175-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-i8s","title":"Phase 2 verification checkpoint - validate caching and batching","description":"# Phase 2 Verification Checkpoint\n\n## Must pass\n1. **E2E correctness**: `pytest tests/e2e -v`\n2. **PathSpec cache hits**: cache hit ratio \u003e 90% after warmup\n3. **Git commit batching**: reduced commit count for multi-record operations\n4. **Snippet optimization**: identical snippets + hit counts\n5. **Top-N selection**: identical ordering for equal scores\n\n## Logging requirements\n- Rich tables for cache stats and commit counts\n- JSON summary artifact for CI\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T01:19:51.966115819-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:39:16.068165551-05:00","dependencies":[{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-pyi","type":"blocks","created_at":"2026-01-12T01:20:19.464744249-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-h4o","type":"blocks","created_at":"2026-01-12T01:20:19.494022627-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-roy","type":"blocks","created_at":"2026-01-12T01:20:19.522898047-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-pk2","type":"blocks","created_at":"2026-01-12T01:20:19.552177577-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-1kw","type":"blocks","created_at":"2026-01-12T01:20:19.579812804-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-i8s","depends_on_id":"mcp_agent_mail-0uh","type":"blocks","created_at":"2026-01-12T01:20:19.609913779-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-i9c","title":"Replace list membership check with set for O(1) lookup","description":"# Replace List Membership with Set for O(1) Lookup\n\n## Problem Statement\nCode checks `if item not in list` inside a loop, resulting in O(n) total\ncomplexity when the list grows.\n\n## Code Location\n`src/mcp_agent_mail/share.py` - Line approximately 696\n\n## Current Code (THE PROBLEM)\n```python\nselected = []\nfor record in all_records:\n    # O(n) membership check on every iteration!\n    if found_record not in selected:\n        selected.append(found_record)\n```\n\n## Impact Analysis\n- First check: scan 0 items\n- Second check: scan 1 item\n- Third check: scan 2 items\n- ...\n- Nth check: scan N-1 items\n- Total: 0 + 1 + 2 + ... + (N-1) = N(N-1)/2 = O(n)\n\nFor 1000 records, that's ~500,000 comparisons!\n\n## Required Fix\n```python\nselected_ids: set[int] = set()  # O(1) membership test\nselected_list: list[Record] = []  # Maintain order if needed\n\nfor record in all_records:\n    if record.id not in selected_ids:  # O(1)!\n        selected_ids.add(record.id)\n        selected_list.append(record)\n```\n\n## Why Use ID for Set\nRecords may not be hashable directly (SQLModel objects with relationships).\nUsing the ID (which is just an int) guarantees hashability.\n\n## Alternative: Use dict for Deduplication\n```python\n# If order doesn't matter and you just need unique records\nselected = {record.id: record for record in all_records}\nunique_records = list(selected.values())\n```\n\n## Finding Similar Patterns\nSearch the codebase for:\n```\nif .* not in .*:\n    .*.append(\n```\n\nThis pattern often indicates O(n) list membership checks.\n\n## Testing Strategy\n1. Verify deduplication works correctly\n2. Verify order is preserved (if required)\n3. Benchmark with 1000, 10000 records\n4. Verify O(n) vs O(n) scaling\n\n## Verification\n```python\nimport time\n\ndef old_way(n):\n    selected = []\n    for i in range(n):\n        if i not in selected:\n            selected.append(i)\n    return selected\n\ndef new_way(n):\n    selected_set = set()\n    selected_list = []\n    for i in range(n):\n        if i not in selected_set:\n            selected_set.add(i)\n            selected_list.append(i)\n    return selected_list\n\n# Time both\nfor n in [100, 1000, 10000]:\n    t1 = time.perf_counter()\n    old_way(n)\n    old_time = time.perf_counter() - t1\n    \n    t2 = time.perf_counter()\n    new_way(n)\n    new_time = time.perf_counter() - t2\n    \n    print(f\"n={n}: old={old_time:.4f}s, new={new_time:.4f}s, speedup={old_time/new_time:.1f}x\")\n```\n\n## Dependencies\nNone - self-contained fix","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:49.542961875-05:00","created_by":"ubuntu","updated_at":"2026-01-12T02:47:17.973161878-05:00"}
{"id":"mcp_agent_mail-ihs","title":"P3 - Concurrent Access Tests","description":"Test behavior under concurrent load.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.87517-05:00","updated_at":"2026-01-05T21:02:37.760344-05:00","deleted_at":"2026-01-05T21:02:37.760344-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-ill","title":"Unit Tests: app.py - Contact Management","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.470372-05:00","updated_at":"2026-01-05T21:00:48.065732-05:00","deleted_at":"2026-01-05T21:00:48.065732-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-ipa","title":"P2 - Error Handling Tests","description":"Test that errors are handled gracefully with clear messages.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.846757-05:00","updated_at":"2026-01-05T21:02:37.297157-05:00","deleted_at":"2026-01-05T21:02:37.297157-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-irp","title":"Guards: Pre-commit Enforcement","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.867804-05:00","updated_at":"2026-01-05T23:24:02.101521-05:00","closed_at":"2026-01-05T23:24:02.101521-05:00","close_reason":"14 comprehensive pre-commit enforcement tests added and passing","dependencies":[{"issue_id":"mcp_agent_mail-irp","depends_on_id":"mcp_agent_mail-aew","type":"blocks","created_at":"2026-01-05T21:02:55.010915-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-jto","title":"Bug: File handle exhaustion (EMFILE) under heavy load","description":"GitHub Issue #59 - After extended sessions, 'Too many open files' error occurs.\n\n**Root Cause Analysis:**\n- LRU repo cache (maxsize=8) helps but doesn't prevent EMFILE\n- Evicted repos tracked in _evicted list may not close promptly due to reference counts\n- Error message shows 'Freed 1 cached repos' indicating cache had minimal repos when error occurred\n\n**Investigation Needed:**\n1. Check if other file handles accumulate (locks, config files, etc.)\n2. Consider increasing LRU cache size or more aggressive cleanup\n3. Add file handle monitoring/metrics\n\n**Current Mitigation:**\n- clear_repo_cache() called on error (app.py:324)\n- Recovery works but user must retry operation\n\nReference: https://github.com/Dicklesworthstone/mcp_agent_mail/issues/59","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T21:17:09.114719-05:00","created_by":"jemanuel","updated_at":"2026-01-05T23:53:47.633305-05:00","closed_at":"2026-01-05T23:53:47.633305-05:00","close_reason":"Implemented LRU cache improvements: increased maxsize to 16, added opportunistic cleanup on get() calls, added warning logging, added monitoring stats. Added 19 tests."}
{"id":"mcp_agent_mail-jts","title":"P1 - MCP Protocol Tests","description":"Test all MCP tools and resources work correctly.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.840562-05:00","updated_at":"2026-01-05T21:02:37.19954-05:00","deleted_at":"2026-01-05T21:02:37.19954-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-jxj","title":"Fix N+1 query pattern in _list_outbox() recipient fetching","description":"# Fix N+1 Query Pattern in _list_outbox()\n\n## Problem\nOutbox listing fetches recipients per message in a loop:\n```\nfor msg in message_rows:\n    recs = await session.execute(select(...).where(MessageRecipient.message_id == msg.id))\n```\nThis is N+1 queries for N messages.\n\n## Fix pattern\n1. Fetch message rows (with limit + since_ts).\n2. Collect message_ids.\n3. Single query for all recipients:\n   `WHERE message_id IN (...)` joined to Agent for names.\n4. Group by message_id and assemble to/cc/bcc lists in memory.\n\n## Acceptance criteria\n- Outbox listing uses 1 query for messages + 1 for recipients.\n- Output identical to current behavior.\n- Query count asserted in tests.\n","notes":"Working on query-count test for _list_outbox recipient fetch (N+1 guard).","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T01:07:09.321252784-05:00","created_by":"ubuntu","updated_at":"2026-01-12T06:51:41.59273688-05:00","closed_at":"2026-01-12T06:51:41.59273688-05:00","close_reason":"Completed"}
{"id":"mcp_agent_mail-k92","title":"Create performance benchmarking suite","description":"# Performance Benchmarking Suite\n\n## Objective\nProvide repeatable benchmarks for latency, throughput, and memory with **rich, detailed logs** and machine-readable summaries.\n\n## Constraints\n- Avoid new dependencies unless absolutely necessary.\n- Use deterministic workloads and fixed dataset sizes.\n\n## Proposed structure\n```\ntests/benchmarks/\n  conftest.py\n  bench_send_message.py\n  bench_fetch_inbox.py\n  bench_list_outbox.py\n  bench_search.py\n  bench_summarize.py\n  utils.py\n```\n\n## Metrics to capture\n- Latency (p50/p95/p99)\n- Throughput (ops/sec)\n- Query counts per operation (from instrumentation)\n- Memory peaks (tracemalloc)\n\n## Logging requirements\n- Rich tables for per-benchmark summary\n- JSON summary written to `tests/benchmarks/results/*.json`\n- Include dataset size, seed, config, and git SHA in logs\n\n## Acceptance criteria\n- Benchmarks can run locally and in CI (optionally skipped in CI by default).\n- Baseline output format is stable for regression comparisons.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:12:24.910676087-05:00","created_by":"ubuntu","updated_at":"2026-01-12T05:08:12.298180504-05:00","closed_at":"2026-01-12T05:08:12.298180504-05:00","close_reason":"Implemented benchmark suite with rich summaries, JSON output, query/memory stats, CI-skippable runs.","dependencies":[{"issue_id":"mcp_agent_mail-k92","depends_on_id":"mcp_agent_mail-dbt","type":"blocks","created_at":"2026-01-12T01:20:16.899096867-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-kfo","title":"Phase 3 verification checkpoint - validate algorithm and concurrency fixes","description":"# Phase 3 Verification Checkpoint\n\n## Must pass\n1. E2E correctness (`pytest tests/e2e -v`)\n2. Unit tests for each algorithmic helper (string normalize, set membership, sort key, stat consolidation)\n3. Rich logging confirms improved timings in micro-benchmarks\n\n## Acceptance criteria\n- Outputs unchanged\n- Micro-benchmarks show expected improvements\n- Logs + JSON artifacts captured\n","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T01:19:52.969311554-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:40:51.897404121-05:00","dependencies":[{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-i8s","type":"blocks","created_at":"2026-01-12T01:20:20.238024562-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-24j","type":"blocks","created_at":"2026-01-12T01:20:20.265951658-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-i9c","type":"blocks","created_at":"2026-01-12T01:20:20.295824093-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-qem","type":"blocks","created_at":"2026-01-12T01:20:20.326548931-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-try","type":"blocks","created_at":"2026-01-12T01:20:20.354308973-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-9tj","type":"blocks","created_at":"2026-01-12T01:20:20.38164059-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-kfo","depends_on_id":"mcp_agent_mail-az3","type":"blocks","created_at":"2026-01-12T01:20:20.409778493-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-kkp","title":"Regression: Session Context Management","description":"priority: 0","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:02:17.830137-05:00","updated_at":"2026-01-05T21:41:50.572476-05:00","closed_at":"2026-01-05T21:41:50.572476-05:00","close_reason":"All 10 session context regression tests implemented (9 pass, 1 skip)"}
{"id":"mcp_agent_mail-l69","title":"P2 - HTTP Transport Tests","description":"Test HTTP/SSE transport layer.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.860107-05:00","updated_at":"2026-01-05T21:02:37.476429-05:00","deleted_at":"2026-01-05T21:02:37.476429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-lps","title":"Unit Tests: config.py","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.467634-05:00","updated_at":"2026-01-05T21:00:48.766376-05:00","deleted_at":"2026-01-05T21:00:48.766376-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-m55","title":"Unit Tests: app.py - File Reservations","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.469857-05:00","updated_at":"2026-01-05T21:00:48.16821-05:00","deleted_at":"2026-01-05T21:00:48.16821-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-mik","title":"Unit Tests: guard.py - Pre-push","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.482758-05:00","updated_at":"2026-01-05T21:00:46.89123-05:00","deleted_at":"2026-01-05T21:00:46.89123-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-mj0","title":"Errors: Invalid Inputs","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.849989-05:00","updated_at":"2026-01-05T23:30:14.939838-05:00","closed_at":"2026-01-05T23:30:14.939838-05:00","close_reason":"Created 25 tests for P2 Errors: Invalid Inputs - all tests pass","dependencies":[{"issue_id":"mcp_agent_mail-mj0","depends_on_id":"mcp_agent_mail-mm2","type":"blocks","created_at":"2026-01-05T21:02:54.436249-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-mm2","title":"Core: Project and Agent Setup","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.838873-05:00","updated_at":"2026-01-05T21:51:54.451595-05:00","closed_at":"2026-01-05T21:51:54.451595-05:00","close_reason":"All 14 project/agent setup tests implemented and passing"}
{"id":"mcp_agent_mail-mzo","title":"Phase 1: Critical N+1 Query Elimination and Index Optimization","description":"# Phase 1: Critical N+1 Elimination + Index Optimization\n\n## Goal\nRemove the highest-latency N+1 patterns and add missing composite indexes.\n\n## Prerequisites\n- Instrumentation (mcp_agent_mail-dbt)\n- E2E correctness suite (mcp_agent_mail-ab8)\n\n## Scope\n- Batched agent lookup for send_message (`_get_agents_batch`) (mcp_agent_mail-dwu, mcp_agent_mail-cyw)\n- Outbox recipient batching (mcp_agent_mail-jxj)\n- Composite indexes for common query patterns (mcp_agent_mail-4yy)\n\n## Expected impact\n- send_message: 5-10x latency reduction on multi-recipient sends\n- list_outbox/fetch_inbox: 10-20x query-count reduction\n- Search/list queries: 3-5x improvement with better indexes\n\n## Acceptance criteria\n- Phase 1 verification checkpoint passes (mcp_agent_mail-pyi)\n- No output changes (isomorphic)\n","status":"open","priority":0,"issue_type":"feature","created_at":"2026-01-12T01:05:50.822840177-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:38:40.463301569-05:00","dependencies":[{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-dwu","type":"blocks","created_at":"2026-01-12T01:13:00.951350401-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-cyw","type":"blocks","created_at":"2026-01-12T01:13:00.992335862-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-jxj","type":"blocks","created_at":"2026-01-12T01:13:01.016724045-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-aid","type":"blocks","created_at":"2026-01-12T01:13:01.038265436-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-4yy","type":"blocks","created_at":"2026-01-12T01:13:01.060561799-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-g77","type":"blocks","created_at":"2026-01-12T01:13:01.083023924-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-mzo","depends_on_id":"mcp_agent_mail-dcy","type":"blocks","created_at":"2026-01-12T01:13:01.103826413-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-n6z","title":"CLI: Mail Commands","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.856438-05:00","updated_at":"2026-01-05T23:31:35.272046-05:00","closed_at":"2026-01-05T23:31:35.272046-05:00","close_reason":"29 comprehensive CLI mail command tests added and passing","dependencies":[{"issue_id":"mcp_agent_mail-n6z","depends_on_id":"mcp_agent_mail-uvf","type":"blocks","created_at":"2026-01-05T21:02:54.732874-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-njf","title":"Core: Contact Management Flow","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.837354-05:00","updated_at":"2026-01-05T22:33:52.72945-05:00","closed_at":"2026-01-05T22:33:52.72945-05:00","close_reason":"Completed P1 Contact Management Flow tests - 15 tests covering contact request/approval workflow, policies, cross-project contacts, and macros"}
{"id":"mcp_agent_mail-nvh","title":"Unit Tests: app.py - Macros","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.470616-05:00","updated_at":"2026-01-05T21:00:47.960622-05:00","deleted_at":"2026-01-05T21:00:47.960622-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-nwz","title":"Performance Optimization Initiative: Eliminate Gross Inefficiencies in Core System","description":"# Performance Optimization Initiative (Isomorphic, test-first)\n\n## Goal\nImprove latency and throughput without changing any outputs or behavior. Every change must be **isomorphic**: identical inputs produce identical outputs.\n\n## Non-goals\n- No feature removal\n- No API/CLI behavior changes\n- No output shape changes\n- No default changes unless fully backward-compatible\n\n## Required guardrails (must exist before optimization)\n1. Query-count + timing instrumentation (mcp_agent_mail-dbt)\n2. E2E correctness suite with golden outputs + rich logging (mcp_agent_mail-ab8)\n3. Benchmark suite + baseline capture (mcp_agent_mail-k92, mcp_agent_mail-59h)\n4. CI regression detection (mcp_agent_mail-tty)\n\n## Phased plan\n**Phase 1 (Critical N+1 + indexes):** mcp_agent_mail-mzo, mcp_agent_mail-dwu, mcp_agent_mail-cyw, mcp_agent_mail-jxj, mcp_agent_mail-4yy, mcp_agent_mail-pyi\n\n**Phase 2 (Caching + Git ops):** mcp_agent_mail-r6n, mcp_agent_mail-h4o, mcp_agent_mail-pk2, mcp_agent_mail-roy, mcp_agent_mail-1kw, mcp_agent_mail-0uh, mcp_agent_mail-i8s\n\n**Phase 3 (Algorithm + concurrency):** mcp_agent_mail-vih, mcp_agent_mail-24j, mcp_agent_mail-i9c, mcp_agent_mail-qem, mcp_agent_mail-try, mcp_agent_mail-kfo\n\n**Phase 4 (Cleanup + polish):** mcp_agent_mail-2uf, mcp_agent_mail-gt4, mcp_agent_mail-21j, mcp_agent_mail-6m1, mcp_agent_mail-9zj, mcp_agent_mail-8pg\n\n## Test and logging expectations\n- All test runs must emit rich, structured logs (use Rich panels/tables for steps and timings).\n- E2E tests must capture exact outputs and compare to golden files.\n- Unit tests must cover utility helpers and edge cases.\n\n## Definition of done\n- All phases complete, all verification checkpoints green.\n- Baseline vs after metrics documented.\n- CI protects against regression.\n","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-12T01:05:12.406011106-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:35:47.527735292-05:00","dependencies":[{"issue_id":"mcp_agent_mail-nwz","depends_on_id":"mcp_agent_mail-mzo","type":"blocks","created_at":"2026-01-12T01:13:19.34487395-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-nwz","depends_on_id":"mcp_agent_mail-r6n","type":"blocks","created_at":"2026-01-12T01:13:19.366586463-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-nwz","depends_on_id":"mcp_agent_mail-vih","type":"blocks","created_at":"2026-01-12T01:13:19.386311312-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-nwz","depends_on_id":"mcp_agent_mail-2uf","type":"blocks","created_at":"2026-01-12T01:13:19.40646028-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-nwz","depends_on_id":"mcp_agent_mail-8pg","type":"blocks","created_at":"2026-01-12T01:20:21.21970083-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-p78","title":"Unit Tests: http.py - Authentication","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.478298-05:00","updated_at":"2026-01-05T21:00:47.157832-05:00","deleted_at":"2026-01-05T21:00:47.157832-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-pk2","title":"Implement per-project commit locks instead of global lock","description":"# Implement Per-Project Commit Locks (avoid global serialization)\n\n## Problem\n`_commit()` uses a single `.commit.lock` at repo root, serializing commits across all projects.\n\n## Fix\n- Place lock under the project root: `projects/\u003cslug\u003e/.commit.lock` (or similar).\n- Keep lock scope limited to files touched by that project.\n- Ensure lock path is stable and deterministic.\n\n## Tests\n- Simulate two projects committing concurrently; ensure no cross-blocking.\n- Ensure intra-project commits still serialize correctly.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T01:09:23.557640132-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:39:49.318429182-05:00","dependencies":[{"issue_id":"mcp_agent_mail-pk2","depends_on_id":"mcp_agent_mail-roy","type":"blocks","created_at":"2026-01-12T01:12:50.058614282-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-pyi","title":"Phase 1 verification checkpoint - validate N+1 elimination and correctness","description":"# Phase 1 Verification Checkpoint\n\n## Must pass\n1. **E2E correctness**\n   - `pytest tests/e2e -v`\n   - Golden outputs identical\n\n2. **Query-count assertions**\n   - send_message (5 recipients): \u003c= 3 queries\n   - list_outbox (20 messages): \u003c= 2 queries\n   - fetch_inbox (20 messages): \u003c= 1-2 queries\n\n3. **Rich logs**\n   - Console output includes Rich tables for counts/timings\n   - JSON summary artifact captured\n\n## Acceptance criteria\n- All assertions pass and logs show reduced query counts.\n- No behavior/output changes.\n","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-12T01:19:51.789839795-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:38:52.286035833-05:00","dependencies":[{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-dwu","type":"blocks","created_at":"2026-01-12T01:20:18.545150156-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-cyw","type":"blocks","created_at":"2026-01-12T01:20:18.576503886-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-jxj","type":"blocks","created_at":"2026-01-12T01:20:18.606383715-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-aid","type":"blocks","created_at":"2026-01-12T01:20:18.63737295-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-4yy","type":"blocks","created_at":"2026-01-12T01:20:18.666281562-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-g77","type":"blocks","created_at":"2026-01-12T01:20:18.694335848-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-dcy","type":"blocks","created_at":"2026-01-12T01:20:18.723771371-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-ab8","type":"blocks","created_at":"2026-01-12T01:20:18.750927237-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-pyi","depends_on_id":"mcp_agent_mail-7hm","type":"blocks","created_at":"2026-01-12T01:21:02.40964484-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-qe7","title":"Security: Path Traversal","description":"priority: 3","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:02:17.871514-05:00","updated_at":"2026-01-06T00:49:03.166984-05:00","closed_at":"2026-01-06T00:49:03.166984-05:00","close_reason":"Created 27 tests covering path traversal security: agent name sanitization, archive tree/content path validation, project slug sanitization, file reservation patterns, attachment path handling, and archive extraction security.","dependencies":[{"issue_id":"mcp_agent_mail-qe7","depends_on_id":"mcp_agent_mail-aew","type":"blocks","created_at":"2026-01-05T21:02:55.30258-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-qem","title":"Replace list.index() in sort key with pre-computed dict","description":"# Replace list.index() in Sort Key with Pre-computed Dict\n\n## Problem Statement\nSort key function uses `list.index()` which is O(p) where p = list length,\nmaking the overall sort O(n * p * log n) instead of O(n log n).\n\n## Code Location\n`src/mcp_agent_mail/share.py` - Line approximately 383\n\n## Current Code (THE PROBLEM)\n```python\npreferred_order = [\"high\", \"normal\", \"low\", \"info\"]\n\n# This calls .index() for EVERY comparison!\nhints.sort(key=lambda hint: preferred_order.index(hint.key) if hint.key in preferred_order else len(preferred_order))\n```\n\n## Impact Analysis\n- sort() makes O(n log n) comparisons\n- Each comparison calls .index() which is O(p)\n- Total: O(n * p * log n) instead of O(n log n)\n- For n=1000 hints and p=4 priorities: 4x slower than necessary\n\n## Required Fix\nPre-compute a dict for O(1) lookups:\n\n```python\npreferred_order = [\"high\", \"normal\", \"low\", \"info\"]\n\n# Pre-compute once: O(p)\norder_map = {key: idx for idx, key in enumerate(preferred_order)}\ndefault_order = len(preferred_order)\n\n# Sort with O(1) lookups\nhints.sort(key=lambda hint: order_map.get(hint.key, default_order))\n```\n\n## Why This Is Better\n- Dict lookup is O(1) vs list.index() O(p)\n- Dict creation is O(p) one-time cost\n- Sort is now pure O(n log n)\n\n## Finding Similar Patterns\nSearch for `.index(` usage within lambda or sort key contexts:\n```\n\\.sort\\(.*\\.index\\(\nsorted\\(.*\\.index\\(\n```\n\n## Testing Strategy\n1. Verify sort order is identical before/after\n2. Benchmark with large hint lists\n3. Test with keys not in preferred_order\n\n## Verification\n```python\nimport random\nimport time\n\npreferred_order = [\"high\", \"normal\", \"low\", \"info\", \"debug\", \"trace\"]\n\n# Generate test data\nhints = [type('Hint', (), {'key': random.choice(preferred_order + ['unknown'])})() \n         for _ in range(10000)]\n\n# Old way\ndef old_sort(hints):\n    return sorted(hints, key=lambda h: preferred_order.index(h.key) if h.key in preferred_order else len(preferred_order))\n\n# New way\ndef new_sort(hints):\n    order_map = {k: i for i, k in enumerate(preferred_order)}\n    default = len(preferred_order)\n    return sorted(hints, key=lambda h: order_map.get(h.key, default))\n\n# Verify identical results\nold_result = old_sort(hints.copy())\nnew_result = new_sort(hints.copy())\nassert [h.key for h in old_result] == [h.key for h in new_result]\n\n# Benchmark\nt1 = time.perf_counter()\nfor _ in range(100):\n    old_sort(hints.copy())\nold_time = time.perf_counter() - t1\n\nt2 = time.perf_counter()\nfor _ in range(100):\n    new_sort(hints.copy())\nnew_time = time.perf_counter() - t2\n\nprint(f\"Old: {old_time:.3f}s, New: {new_time:.3f}s, Speedup: {old_time/new_time:.1f}x\")\n```\n\n## Dependencies\nNone - self-contained fix","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:51.163791202-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:10:51.163791202-05:00"}
{"id":"mcp_agent_mail-r6n","title":"Phase 2: Caching and Git Operation Batching","description":"# Phase 2: Caching and Git Operation Batching\n\n## Goal\nReduce repeated computation and Git overhead without changing outputs.\n\n## Scope\n- Cache PathSpec compilation (`mcp_agent_mail-h4o`)\n- Per-project commit locks (`mcp_agent_mail-pk2`)\n- Commit batching for multi-file operations (`mcp_agent_mail-roy`)\n- Search snippet optimization (`mcp_agent_mail-1kw`)\n- Top-N selection via heapq where beneficial (`mcp_agent_mail-0uh`)\n\n## Expected impact\n- PathSpec conflicts: 10-50x faster after warmup\n- Git commit throughput: 3-5x improvement for multi-file operations\n- Search UI responsiveness: ~3x improvement in snippet generation\n\n## Acceptance criteria\n- Phase 2 verification checkpoint passes (mcp_agent_mail-i8s)\n- No output changes (isomorphic)\n","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-12T01:05:51.817252389-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:39:04.914651609-05:00","dependencies":[{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-mzo","type":"blocks","created_at":"2026-01-12T01:06:18.773869151-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-h4o","type":"blocks","created_at":"2026-01-12T01:13:10.500589976-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-roy","type":"blocks","created_at":"2026-01-12T01:13:10.523414854-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-pk2","type":"blocks","created_at":"2026-01-12T01:13:10.546568452-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-1kw","type":"blocks","created_at":"2026-01-12T01:13:10.568191737-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-0uh","type":"blocks","created_at":"2026-01-12T01:13:10.587622482-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-r6n","depends_on_id":"mcp_agent_mail-pyi","type":"blocks","created_at":"2026-01-12T01:21:26.776571701-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-roy","title":"Consolidate Git commits for related operations","description":"# Consolidate Git Commits for Related Operations\n\n## Problem\nSome operations write multiple files but commit per-file (e.g., file reservations). This multiplies Git overhead and lock time.\n\n## Target\n- `_write_file_reservation_records()` should batch multiple records into **one** commit per tool call.\n- Any other multi-file write within a single tool call should commit once, not per file.\n\n## Approach\n- Add a batching helper (e.g., `commit_batch` context or pass `commit_message` + list of paths).\n- Keep commit message semantics identical (include tool metadata).\n\n## Tests\n- Verify number of commits created per tool call is reduced (1 instead of N).\n- Ensure content and commit messages are still correct.\n","status":"closed","priority":1,"issue_type":"task","assignee":"CopperMoose","created_at":"2026-01-12T01:09:23.409860588-05:00","created_by":"ubuntu","updated_at":"2026-01-12T07:05:46.168681547-05:00","closed_at":"2026-01-12T07:05:46.168681547-05:00","close_reason":"Batch file_reservation commits via write_file_reservation_records; file_reservation_paths batches payloads; added commit-count test; ran pytest -k batches_commits, ruff, uvx ty."}
{"id":"mcp_agent_mail-tm6","title":"Milestone: Critical Path Coverage","description":"priority: 1","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.880711-05:00","updated_at":"2026-01-06T00:13:24.562538-05:00","closed_at":"2026-01-06T00:13:24.562538-05:00","close_reason":"All P0-P1 critical path tests completed: kkp (Session Context), yhk (Datetime), aew (File Reservation), uvf (Message Delivery)","dependencies":[{"issue_id":"mcp_agent_mail-tm6","depends_on_id":"mcp_agent_mail-yhk","type":"blocks","created_at":"2026-01-05T21:02:56.643878-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-tm6","depends_on_id":"mcp_agent_mail-kkp","type":"blocks","created_at":"2026-01-05T21:02:56.778506-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-tm6","depends_on_id":"mcp_agent_mail-uvf","type":"blocks","created_at":"2026-01-05T21:02:56.920383-05:00","created_by":"jemanuel"},{"issue_id":"mcp_agent_mail-tm6","depends_on_id":"mcp_agent_mail-aew","type":"blocks","created_at":"2026-01-05T21:02:57.079543-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-try","title":"Consolidate repeated file existence checks into single stat()","description":"# Consolidate File Existence Checks\n\n## Problem Statement\nCode performs multiple separate file existence checks (stat syscalls) when\na single stat() call with exception handling would suffice.\n\n## Code Location\n`src/mcp_agent_mail/storage.py` - Lines approximately 403-424\n\n## Current Code (THE PROBLEM)\n```python\n# Multiple stat() syscalls for the same logical check\nif not self._path.exists():        # stat() #1\n    return False\n    \nif self._metadata_path.exists():   # stat() #2\n    metadata = self._load_metadata()\nelif self._legacy_path.exists():   # stat() #3\n    metadata = self._load_legacy()\n```\n\n## Impact Analysis\n- Each .exists() is a stat() syscall\n- stat() requires kernel context switch\n- 3 syscalls where 1-2 would suffice\n- On network filesystems, latency compounds significantly\n\n## Required Fix\nUse exception handling for control flow:\n\n```python\ndef _load_project_data(self) -\u003e ProjectData | None:\n    \"\"\"Load project data with minimal syscalls.\"\"\"\n    try:\n        # Try primary path first - one stat() + read if exists\n        return self._load_metadata()\n    except FileNotFoundError:\n        pass\n    \n    try:\n        # Fall back to legacy path\n        return self._load_legacy()\n    except FileNotFoundError:\n        return None\n```\n\nOr use single stat() with result caching:\n\n```python\ndef _check_paths(self) -\u003e tuple[bool, bool, bool]:\n    \"\"\"Check multiple path existence with minimal syscalls.\"\"\"\n    main_exists = self._path.exists()\n    if not main_exists:\n        return False, False, False\n    \n    # Only check sub-paths if main exists\n    metadata_exists = self._metadata_path.exists()\n    legacy_exists = self._legacy_path.exists() if not metadata_exists else False\n    \n    return main_exists, metadata_exists, legacy_exists\n```\n\n## EAFP vs LBYL\nPython idiom \"Easier to Ask Forgiveness than Permission\" (EAFP) suggests:\n- Try the operation, handle exception if it fails\n- Rather than checking if operation will succeed then doing it\n\nThis is especially efficient for file operations where the check and\noperation are separate syscalls.\n\n## Finding Similar Patterns\nSearch for consecutive .exists() calls:\n```python\nif .*\\.exists\\(\\)\n```\n\n## Testing Strategy\n1. Verify behavior unchanged for existing files\n2. Verify behavior unchanged for missing files\n3. Use strace to count stat() syscalls before/after\n4. Benchmark on local and network filesystems\n\n## Verification\n```bash\n# Count syscalls before fix\nstrace -e stat,statx,newfstatat python -c \"project._check_paths()\" 2\u003e\u00261 | grep -c stat\n\n# Count syscalls after fix\nstrace -e stat,statx,newfstatat python -c \"project._check_paths()\" 2\u003e\u00261 | grep -c stat\n```\n\n## Dependencies\nNone - self-contained fix","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T01:10:51.317969551-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:48:46.271666531-05:00","closed_at":"2026-01-12T01:48:46.271666531-05:00","close_reason":"Low ROI / micro-optimizations or behavior-risky; defer unless benchmarks show hotspot."}
{"id":"mcp_agent_mail-tty","title":"Add CI performance regression detection","description":"# CI Performance Regression Detection\n\n## Purpose\nPrevent regressions in query counts and latency after optimizations.\n\n## Components\n1. **Query count assertions**\n   - Use instrumentation helpers to assert max queries per operation.\n   - Fail CI if counts exceed thresholds.\n\n2. **Benchmark diff checks**\n   - Compare current results vs baseline JSON.\n   - Flag regressions above configurable thresholds (e.g., +15% p95).\n\n3. **Logging**\n   - Rich summary in CI logs\n   - JSON artifact for download and comparison\n\n## Acceptance criteria\n- CI fails on query-count regressions or significant latency regressions.\n- CI logs show clear before/after numbers.\n","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-12T01:27:40.364623173-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:37:09.191163879-05:00","dependencies":[{"issue_id":"mcp_agent_mail-tty","depends_on_id":"mcp_agent_mail-dbt","type":"blocks","created_at":"2026-01-12T01:27:45.447734439-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-tty","depends_on_id":"mcp_agent_mail-ab8","type":"blocks","created_at":"2026-01-12T01:27:45.478111323-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-u8g","title":"Integration Tests: Thread Conversations","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.485294-05:00","updated_at":"2026-01-05T21:00:46.22444-05:00","deleted_at":"2026-01-05T21:00:46.22444-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-udi","title":"E2E: Disaster Recovery","description":"priority: 4","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-05T21:02:17.879357-05:00","updated_at":"2026-01-06T02:34:40.022403-05:00","closed_at":"2026-01-06T02:34:40.022403-05:00","close_reason":"5 E2E disaster recovery tests implemented and passing","dependencies":[{"issue_id":"mcp_agent_mail-udi","depends_on_id":"mcp_agent_mail-enu","type":"blocks","created_at":"2026-01-05T21:02:56.527536-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-uvf","title":"Core: Message Delivery Flow","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.835672-05:00","updated_at":"2026-01-05T22:06:09.098428-05:00","closed_at":"2026-01-05T22:06:09.098428-05:00","close_reason":"Created 21 comprehensive tests for message delivery flow covering: basic sending, multiple recipients (to/cc/bcc), threads, importance levels, ack flags, inbox fetching, replies, read/acknowledge workflows, and error handling. All tests passing."}
{"id":"mcp_agent_mail-vih","title":"Phase 3: Algorithm and Concurrency Improvements","description":"# Phase 3: Algorithm and Concurrency Improvements\n\n## Goal\nTighten algorithmic inefficiencies while preserving behavior.\n\n## Scope\n- String normalization: replace loop with regex (mcp_agent_mail-24j)\n- List membership -\u003e set (mcp_agent_mail-i9c)\n- Sort key list.index -\u003e dict lookup (mcp_agent_mail-qem)\n- Consolidate repeated stat() calls (mcp_agent_mail-try)\n\n## Expected impact\n- 30-50% improvement in these hot paths; lower CPU under load.\n\n## Acceptance criteria\n- Phase 3 verification checkpoint passes (mcp_agent_mail-kfo)\n- Output identical to current behavior\n","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-12T01:05:52.421204634-05:00","created_by":"ubuntu","updated_at":"2026-01-12T01:40:41.873773032-05:00","dependencies":[{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-r6n","type":"blocks","created_at":"2026-01-12T01:06:18.790884586-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-24j","type":"blocks","created_at":"2026-01-12T01:13:11.153106468-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-i9c","type":"blocks","created_at":"2026-01-12T01:13:11.17538116-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-qem","type":"blocks","created_at":"2026-01-12T01:13:11.195094317-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-try","type":"blocks","created_at":"2026-01-12T01:13:11.216408409-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-9tj","type":"blocks","created_at":"2026-01-12T01:13:11.237984335-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-az3","type":"blocks","created_at":"2026-01-12T01:13:11.259260066-05:00","created_by":"ubuntu"},{"issue_id":"mcp_agent_mail-vih","depends_on_id":"mcp_agent_mail-i8s","type":"blocks","created_at":"2026-01-12T01:21:26.823685949-05:00","created_by":"ubuntu"}]}
{"id":"mcp_agent_mail-w51","title":"HTTP: Authentication","description":"priority: 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.864235-05:00","updated_at":"2026-01-06T00:34:24.246687-05:00","closed_at":"2026-01-06T00:34:24.246687-05:00","close_reason":"23 HTTP authentication tests: bearer auth, localhost bypass, CORS/health bypass, RBAC, OAuth metadata, JWT helpers, rate limiting"}
{"id":"mcp_agent_mail-xhf","title":"E2E Test Script: Performance Under Load","description":"priority: 3","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.487882-05:00","updated_at":"2026-01-05T21:00:45.544252-05:00","deleted_at":"2026-01-05T21:00:45.544252-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-y35","title":"Testing Infrastructure Foundation","description":"priority: 1","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.465256-05:00","updated_at":"2026-01-05T21:00:48.939985-05:00","deleted_at":"2026-01-05T21:00:48.939985-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-y59","title":"P3 - Performance Tests","description":"Test performance characteristics.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.877469-05:00","updated_at":"2026-01-05T21:02:37.860358-05:00","deleted_at":"2026-01-05T21:02:37.860358-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-yh8","title":"Security: Input Sanitization","description":"priority: 3","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T21:02:17.870336-05:00","updated_at":"2026-01-06T00:53:26.090299-05:00","closed_at":"2026-01-06T00:53:26.090299-05:00","close_reason":"Added 28 comprehensive security tests: FTS sanitization, SQL injection prevention, path traversal, DoS handling, null byte injection, unicode attacks, XSS prevention, and malformed JSON handling. All tests pass.","dependencies":[{"issue_id":"mcp_agent_mail-yh8","depends_on_id":"mcp_agent_mail-uvf","type":"blocks","created_at":"2026-01-05T21:02:55.202381-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-yhk","title":"Regression: Datetime Naive/Aware Handling","description":"priority: 0","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T21:02:17.828319-05:00","updated_at":"2026-01-05T21:34:15.142142-05:00","closed_at":"2026-01-05T21:34:15.142142-05:00","close_reason":"All 20 datetime regression tests implemented and passing"}
{"id":"mcp_agent_mail-yi0","title":"Unit Tests: cli.py - Core Commands","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.472698-05:00","updated_at":"2026-01-05T21:00:47.51517-05:00","deleted_at":"2026-01-05T21:00:47.51517-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-ypm","title":"Unit Tests: storage.py - Archive Operations","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.471913-05:00","updated_at":"2026-01-05T21:00:47.676906-05:00","deleted_at":"2026-01-05T21:00:47.676906-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-yzu","title":"MCP Tools: Happy Path Coverage","description":"priority: 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T21:02:17.841695-05:00","updated_at":"2026-01-05T22:36:39.811899-05:00","closed_at":"2026-01-05T22:36:39.811899-05:00","close_reason":"All MCP tools have happy path coverage across existing test suite: test_server.py, test_project_agent_setup.py, test_message_delivery_regression.py, test_contact_management_flow.py, test_file_reservation_lifecycle.py, test_macros.py, test_guard_tools.py","dependencies":[{"issue_id":"mcp_agent_mail-yzu","depends_on_id":"mcp_agent_mail-mm2","type":"blocks","created_at":"2026-01-05T21:02:54.212411-05:00","created_by":"jemanuel"}]}
{"id":"mcp_agent_mail-z00","title":"Integration Tests: HTTP Transport","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.486362-05:00","updated_at":"2026-01-05T21:00:45.977935-05:00","deleted_at":"2026-01-05T21:00:45.977935-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-z9g","title":"Unit Tests: share.py - Archive Restore","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.483519-05:00","updated_at":"2026-01-05T21:00:46.661028-05:00","deleted_at":"2026-01-05T21:00:46.661028-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-zgs","title":"P0 - Critical Regression Tests","description":"These tests prevent recurrence of known bugs and must pass before any release.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T21:02:17.82546-05:00","updated_at":"2026-01-05T21:02:37.011981-05:00","deleted_at":"2026-01-05T21:02:37.011981-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"mcp_agent_mail-zmk","title":"Unit Tests: models.py","description":"priority: 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-05T20:56:40.466891-05:00","updated_at":"2026-01-05T21:00:48.845938-05:00","deleted_at":"2026-01-05T21:00:48.845938-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
