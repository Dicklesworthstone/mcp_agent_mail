# Project TODO (in progress)

- [ ] Persistence archive
  - [x] Define storage root and per-project structure (agents/, messages/, claims/, attachments/)
  - [x] Implement Markdown writing with JSON front matter for canonical message + inbox/outbox copies
  - [x] Persist agent profiles to json under agents/
  - [x] Persist claim JSON artifacts with hashed filenames
  - [x] Ensure all file operations async-friendly (use asyncio.to_thread as needed)
  - [x] Integrate GitPython: repo init per project, add commit helper with lock handling
  - [x] Add advisory file lock to serialize archive writes
- [ ] Agent identity workflow
  - [ ] Update name generator to check DB + filesystem for uniqueness
  - [ ] Expose create identity tool returning full profile (program/model/task)
  - [x] Track last_active and ensure updates on interactions
- [ ] Messaging enhancements
  - [x] Support message replies (thread_id, subject prefix)
  - [x] Include read/ack tools updating timestamps
  - [x] Implement urgent-only filter and ack-required flag handling
  - [x] Inline/attachment WebP conversion with Pillow; store under attachments/
  - [x] Provide acknowledgements tool
- [ ] Claims/leases
  - [x] Expand claim tool to detect glob overlaps
  - [x] Implement release_claims tool returning updated status
  - [x] Build resource for active claims per project
  - [ ] Prepare pre-commit hook generator installing guard
- [ ] Resources
  - [x] resource://message/{id}{?project} returning body + metadata
  - [x] resource://thread/{thread_id}{?project,include_bodies}
  - [x] resource://inbox/{agent}{?project,...}
  - [x] resource://claims/{project}{?active_only}
- [ ] Search & summaries
  - [x] Configure SQLite FTS tables/triggers for messages
  - [x] search_messages tool w/ query param
  - [x] summarize_thread tool returning keypoints/actions
- [ ] Config/auth/CLI
  - [ ] Extend settings for storage root, git author, attachment limits
  - [ ] Provide CLI command to run migrations and list projects/agents
  - [ ] Add optional bearer auth scaffold for HTTP transport
  - [ ] Implement health/readiness endpoints on HTTP app via FastAPI wrapper
  - [ ] Enrich CLI output with Rich panels/logging
- [ ] Testing
  - [ ] Expand tests to cover filesystem archive & git commits
  - [ ] Test claims conflict detection, release tool, resources
  - [ ] Test search and summaries tools
  - [ ] Test CLI serve-http with auth defaults and migrations command
  - [ ] Add image conversion test (mocking Pillow)
